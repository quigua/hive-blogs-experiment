document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".tabs");const o=document.querySelectorAll(".tab-button"),n=document.querySelectorAll(".tab-content"),d={posts:{nextStartAuthor:"",nextStartPermlink:"",hasMorePosts:!0,currentPage:0},reblogs:{nextStartAuthor:"",nextStartPermlink:"",hasMorePosts:!0,currentPage:0}};var t,e=document.getElementById("posts-tab-content");d.posts.nextStartAuthor=e.dataset.nextStartAuthor||"",d.posts.nextStartPermlink=e.dataset.nextStartPermlink||"",d.posts.hasMorePosts="true"===e.dataset.hasMorePosts,!d.posts.hasMorePosts&&((t=e.querySelector(".load-more-button"))&&(t.style.display="none"),t=e.querySelector(".no-more-posts-message"))&&(t.style.display="block");const l=async t=>{var e=t.target.closest(".tab-content"),r=e.dataset.contentType,a=e.dataset.username,s=parseInt(e.dataset.postsPerPage),o=d[r];if(o.hasMorePosts){t.target.textContent="Cargando...",t.target.disabled=!0;try{var n=new URL("https://dreamy-baklava-d17cb6.netlify.app/.netlify/functions/get-user-posts");n.searchParams.append("username",a),n.searchParams.append("limit",s),n.searchParams.append("contentType",r),o.nextStartAuthor&&o.nextStartPermlink&&(n.searchParams.append("start_author",o.nextStartAuthor),n.searchParams.append("start_permlink",o.nextStartPermlink));var l,c=await(await fetch(n.toString())).json();c.error?(console.error(`Error al cargar ${r}:`,c.error),alert(`Error al cargar ${r}: `+(c.error.message||c.error)),o.hasMorePosts=!1):(l=c.posts||[],console.log(`Cargados ${l.length} nuevos ${r}.`),((t,e,r)=>{const a=e.querySelector(".post-list");r||(a.innerHTML=""),0===t.length?r&&0!==a.children.length||(a.innerHTML="<p>No se encontraron más elementos.</p>"):t.forEach(t=>{var e=document.createElement("div");e.className="post-card",e.innerHTML=`
                <h3><a href="/post-detail/?author=${t.author}&permlink=${t.permlink}">${t.title}</a></h3>
                <p>Por ${t.author} el ${new Date(t.created).toLocaleDateString()}</p>
                <p>${t.body.substring(0,150)}...</p>
            `,a.appendChild(e)})})(l,e,!0),o.nextStartAuthor=c.nextStartAuthor||"",o.nextStartPermlink=c.nextStartPermlink||"",o.hasMorePosts=c.hasMore,o.currentPage++)}catch(t){console.error(`Error de red al cargar ${r}:`,t),alert(`Error de red al cargar ${r}. Inténtelo de nuevo.`),o.hasMorePosts=!1}finally{t.target.textContent="Cargar más "+("posts"===r?"posts":"reblogs"),t.target.disabled=!1,o.hasMorePosts||(t.target.style.display="none",e.querySelector(".no-more-posts-message").style.display="block")}}else console.log(`No hay más ${r} para cargar.`)},r=(document.querySelectorAll(".load-more-button").forEach(t=>{t.addEventListener("click",l)}),async e=>{o.forEach(t=>{t.dataset.tab===e?t.classList.add("active"):t.classList.remove("active")}),n.forEach(t=>{t.id===e+"-tab-content"?t.classList.add("active"):t.classList.remove("active")});var t=document.getElementById(e+"-tab-content"),r=d[e],a=t.querySelector(".post-list"),s=t.querySelector(".load-more-button"),t=t.querySelector(".no-more-posts-message");"reblogs"===e&&0===r.currentPage?(a.innerHTML="<p>Cargando reblogs...</p>",await l({target:s})):r.hasMorePosts?(s&&(s.style.display="block"),t&&(t.style.display="none")):(s&&(s.style.display="none"),t&&(t.style.display="block"))});o.forEach(t=>{t.addEventListener("click",()=>{r(t.dataset.tab)})}),r("posts")});